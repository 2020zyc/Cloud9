<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><title>Cloud9: A MapReduce Library for Hadoop</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" />
</head>

<body>

<center><table width="80%"><tbody><tr><td align="left">

<h2>Cloud<sup><small>9</small></sup>: Getting Started with Pig</h2>

<p>by Jimmy Lin</p>

<p>
<small>(Page first created: 24 May 2010; last updated:
<script language="JavaScript" type="text/javascript">
<!--
var LastUpdated = "$Date$";
LastUpdated = LastUpdated.substring(LastUpdated.length-14, LastUpdated.length-3);
document.writeln (LastUpdated);
-->
</script>)
</small>
</p>

<div class="main">

<h3>Introduction</h3>

<p>This guide will get you started with Pig on the Google/IBM CLuE
cluster.  Thanks to Ashwini Sonavane for helping me gather some of the
materials here.</p>

<p>It's assumed that you've already connected successfully to the CLuE
cluster; if not see <a href="start-Google-cluster.html">this getting
started guide</a>.  To get started, download
Pig <a href="http://hadoop.apache.org/pig/releases.html">here</a>.
The current latest version is 0.7.0, released on May 13, 2010.  Unpack
the distribution.</p>

<h3>Setting Up the Environment</h3>

<p>You'll need to set up a number of environment variables.  The first
specifies the version of Hadoop:</p>

<pre>
export PIG_HADOOP_VERSION=20
</pre>

<p>The second should point to your Hadoop distribution, with the
proper XML configuration files to connect to the CLuE cluster:</p>

<pre>
export PIG_CLASSPATH=/path/to/hadoop/conf
</pre>

<p>Finally, add Pig to your path:<p>

<pre>
export PATH=/path/to/pig/bin:$PATH
</pre>

<p>And that's basically it!  You should now be able to pop into the Grunt shell:</p>

<pre>
pig
</pre>

<p>Watch for these two info messages:</p>

<pre>
Connecting to hadoop file system at: xxx
Connecting to map-reduce job tracker at: yyy
</pre>

<p>You should see the CLuE cluster namenode and jobtracker where xxx
and yyy appear in the above messages.  On the other hand, if you see
something like:</p>

<pre>
Connecting to hadoop file system at: file:///
</pre>

<p>This means that Pig wasn't able to connect to the cluster.</p>

<h3>Word Count in Pig</h3>

<p>No demo would be complete without a word count example, right?
Let's start by putting our sample collection in HDFS:</p>

<pre>
hadoop fs -put bible+shakes.nopunc /tmp
</pre>

<p>Here's a script that performs word count:</p>

<pre>
A = load '/tmp/bible+shakes.nopunc';
B = foreach A generate flatten(TOKENIZE((chararray)$0)) as word;
C = filter B by word matches '\\w+';
D = group C by word;
E = foreach D generate COUNT(C) as count, group as word;
F = order E by count desc;
store F into '/tmp/wc';
</pre>

<p>You can see that in the output, we have words in the collection
sorted by decreasing frequency:</p>

<pre>
$ hadoop fs -cat /tmp/wc/part-r-00000 | head -10
93739   the
79182   and
53121   of
33929   to
30240   i
24407   that
24350   in
23504   a
17312   my
17087   he
</pre>

<p>By changing one line, we can sort alphabetically by word instead:</p>

<pre>
F = order E by word;
</pre>

<p>Try doing that in Java!</p>

<p style="padding-top: 25px"><a href="../index.html">Back to main page</a></p>

</div>

<table width="100%" border="0" cellpadding="0" cellspacing="0" style="padding-top: 10px;">
<tr><td valign="top" align="left">
</td>
<td valign="top" align="right">
  <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/us/">
  <img src="../images/creative-commons.png" border="0" alt="Creative Commons: Attribution-Noncommercial-Share Alike 3.0 United States"/>
  </a>
  <a href="http://validator.w3.org/check/referer">
  <img src="../images/valid-xhtml10.gif" border="0"
       alt="Valid XHTML 1.0!" height="31" width="88" />
  </a>
  <a href="http://jigsaw.w3.org/css-validator/check/referer">
  <img style="border:0;width:88px;height:31px"
       src="../images/vcss.gif" 
       alt="Valid CSS!" />
  </a>
</td></tr></table>

</td></tr></tbody></table></center>

</body></html>
